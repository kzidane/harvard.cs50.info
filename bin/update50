#!/bin/bash

# redirect output of all commands to $LOG
mkdir -p /home/ubuntu/.cs50/logs
LOG=/home/ubuntu/.cs50/logs/update50.log

# merge old log file (if exists)
if [ -f /home/ubuntu/lib/ide50.log ]; then
    mv /home/ubuntu/lib/ide50.log $LOG &>/dev/null
    rm -f /home/ubuntu/lib/ide50.log &>/dev/null
fi

exec > >(sudo tee -a "$LOG")

echo -e "\nDO NOT CLOSE THIS WINDOW OR PUT YOUR COMPUTER TO SLEEP <3\n"
sleep 2

echo -e "\n\n\nUpdate50 - $(date -R)"

# curl latest update50 script, passing in any command-line args
curl -H 'Cache-Control: no-cache' -sL https://cs50.ly/update50 | bash -s $@

if [ $? -ne 0 ]
then
    echo "Something went wrong! The output has been logged in $LOG"
    exit 1
fi
